{{/*###
	Handler=/u
	TitleBar=User Profile
	DisableMainContainer=True
*/}}

{{/* TODO: make this work on mobile (will wait for hubz to make a mobile site design) */}}
{{/* TODO: show a banner if the user is silenced */}}
{{ define "tpl" }}
{{/* get some data we need */}}
{{ $gqm := atoi (.Gin.Query "mode") }}
{{ with (.Get "users/full?id=%d" .UserID) }}
{{ $global := . }}
{{ $favouritemode := _or $gqm .favourite_mode }}
{{ $user := . }}

{{ $donor := has .privileges 4 }}

<link rel="stylesheet" href="/static/css/pages/profile.css" />
<div class="page-width">
			{{/* TODO: what's this for? */}}
			<script>
				window.favouriteMode = {{ $favouritemode }};
				window.userID = {{ .id }};
			</script>
	<div class="main-container-topper">
		{{/* TODO: Icons */}}
		<div style="/*! margin: 2em; */margin-left: 2em;align-content: center;display: flex;">
			<span style="text-color: rgba(255,255,255,.93);color: rgba(255,255,255,.93);font-size: 1rem;">{{ .username }}'s Profile</span>
		</div>
		{{/* TODO: fix this */}}
		{{ $modString := gameMods }}
		{{ $modInt := gameMods }}
		{{ $modeString := modes }}
		{{ $modeInt := modes }}
		<div class="game-mode-selector" id="mode-menu">
			{{ range $modeInt, $modeString := modes }}
				<span class="{{ favMode $favouritemode $modeInt }}item game-mode-selector-item" data-mode="{{ $modeInt }}" href="/u/{{ $user.id }}?mode={{ $modeInt }}&mod={{ $modInt }}">{{ $modeString }}</span>
			{{ end }}
		</div>
	</div>
	<div class="profile-game-mods-segment">
		<div class="game-mod-selector" id="mod-menu">
			{{ range $modInt, $modString := gameMods }}
			<span class="{{ $modInt }}item game-mode-selector-item" data-mode="{{ $modInt }}" href="/u/{{ $user.id }}?mode={{ $modeInt }}&mod={{ $modInt }}">{{ $modString }}</span>
			{{ end }}
		</div>
	</div>
	<div class="profile-bg" style="--bg: var(--profile-bg)"></div>
	<div class="profile-user-segment">
		<img class="profile-avatar" src="{{ config "AvatarURL" }}/{{ .id }}">
		<div class="profile-main-info-container">
			<div class="profile-main-details-container">
				<div class="profile-username-container">
					<div class="profile-username-text">
						{{ .username }}
					</div>
					{{ if .verified_player }}
						<span class="fa-solid fa-check profile-verified-badge"></span>
					{{ end }}
					{{ if $donor }}
						<span class="fas fa-heart profile-donor-badge"></span>
					{{ end }}
					{{ range .badges }}
						{{/* just repurpose the icon for now */}}
						<div class="profile-badge" style="--color: {{ .icon }}">{{ .name }}</div>
					{{ end }}
				</div>
				<div class="profile-country-clan-container">
					<div class="profile-country-container">
						<img
						src="https://twemoji.maxcdn.com/v/latest/svg/{{ countryCodepoints .country }}.svg"
						class="profile-country-flag" />
						{{ countryReadable1 .country }}
					</div>

					{{/* get clan info */}}
					{{ $clan := . }}

					{{ if eq $clan.clan.name "" }}
						{{/* just don't show anything if we arent in a clan */}}
					{{ else }}
						<div class="profile-clan-container">
							<i class="fa-solid fa-users profile-clan-flag"></i>
							{{/* show our clan name */}}
							{{ $clan.clan.name }}
						</div>
					{{ end }}
				</div>
			</div>
			<div class="profile-pinned-medal-container">
				<div class="profile-pinned-medal-text-container">
					pinned medals <img src="/static/icons/pinned-medal.svg" class="profile-pinned-medal-icon"/>
				</div>
				<div class="profile-pinned-medal-medal-container">
					TODO: pinned medals
				</div>
			</div>
		</div>
	</div>
</div>
{{ end }}
{{ end }}