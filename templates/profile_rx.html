{{/*###
	Handler=/u
	TitleBar=User Profile
	KyutGrill=settings2.jpg
	HugeHeadingRight=true
*/}}
{{ define "tpl" }}
<div class="ui container">
	{{ if .UserID }}
		{{ $gqm := atoi (.Gin.Query "mode") }}
		{{ $global := . }}
		{{ $hstb1 := eq .UserID 999 }}
		{{ $hstb2 := eq .UserID 1000 }}
		{{ $hstb3 := eq .UserID 1001 }}
		{{ $hstb4 := eq .UserID 1002 }}
		{{ with (.Get "users/rxfull?id=%d" .UserID) }}
			{{ $favouritemode := _or $gqm .favourite_mode }}
			<script>
				window.favouriteMode = {{ $favouritemode }};
				window.userID = {{ .id }};
			</script>
			{{ if after .silence_info.end }}
<div class="restricted" style="
background: repeating-linear-gradient( -45deg, #FF3D3D, #FF3D3D 10px, #FF0000 10px, #FF0000 20px);
text-align: center;
color: white;
padding: 8px;
">
						<h1 style="margin-top: 0px; color: white;">{{ $global.T "This user is silenced until %s!" (time .silence_info.end) | html }}</h1>
						<div>
        					{{ $global.T "They were silenced for %s." (.silence_info.reason | htmlescaper) | html }}
						</div>
					</div>

			{{ end }}
			{{ if hasAdmin $global.Context.User.Privileges }}
				{{ $restr := not (has .privileges 1) }}
				{{ $disab := not (has .privileges 2) }}
				{{ $pend  := has .privileges 1048576 }}
				{{ if and $disab $restr }}
				{{ if $pend }}
				<div class="notification-banner content-container text-segment">
					<h1 style="margin-top: 0px; color: white;">This user is pending!</h1>
					<div>
						(Only admins can see this!)
					</div>
				</div>
				{{ else }}
				<div class="notification-banner content-container text-segment">
					<h1 style="margin-top: 0px; color: white;">This user is banned!</h1>
					<div>
						(Only admins can see this!)
					</div>
				</div>
				{{ end }}
			{{ else if $restr }}
			<div class="notification-banner content-container text-segment">
					<h1 style="margin-top: 0px; color: white;">This user is restricted!</h1>
					<div>
						(Only admins can see this!)
					</div>
				</div>
									
			{{ else if $disab }}
			<div class="notification-banner content-container text-segment">
					<h1 style="margin-top: 0px; color: white;">This user is locked!</h1>
					<div>
						(Only admins can see this!)
					</div>
				</div>
			{{ end }}
			{{ end }}
			<div class="ui top attached segment overflow auto">
				<div class="magic table">
					<div class="table element">
						{{ if eq $global.UserID $global.Context.User.ID }}
							<a href="/settings/avatar">
						{{ end }}
								<img src="{{ config "AvatarURL" }}/{{ .id }}" alt="avatar" class="user avatar">
						{{ if eq $global.UserID $global.Context.User.ID }}
							</a>
						{{ end }}
					</div>
					<div class="table element">
						<h1 class="ui header">						
							<b>
								{{ .username }}
							</b>
						</h1>
						
						{{ $oof := . }}
						
						{{ if eq $oof.clan.name "" }}
						{{ $global.T "Clan: None" }}
						{{ else }}
						{{ $global.T "Clan: %s" ($oof.clan.name) }}
						{{ end }}
						
						{{ if .username_aka }}
							<div class="subtitle">
								{{ $global.T "(aka <b>%s</b>)" (.username_aka | htmlescaper) | html }}
							</div>
						{{ end }}
						{{ with bgetv1 "isOnline?id=%.0f" .id }}
							<div class="subtitle">
								<i class="{{ if .result }}green{{ else }}red{{ end }} circle icon"></i>
								{{ if .result }}{{ $global.T "Online" }}{{ else }}{{ $global.T "Offline" }}{{ end }}
							</div>
						{{ end }}
					</div>
					{{ range .badges }}
					<img src="{{ .icon }}" alt="{{ .name }}" class="profibadge user avatar">
					{{ end }}

				</div>
				<div class="magic table floating right">
					<div class="table element">
						{{ range $k, $v := (slice .std .taiko .ctb .mania) }}
							<h1 data-mode="{{ $k }}"{{ if ne $k (int $favouritemode) }} hidden{{ end }}>{{ with and $v $v.global_leaderboard_rank }}#{{ . }}{{ else }}{{ $global.T "Not ranked" }}{{ end }}</h1>
						{{ end }}
						<div id="profile-actions">
							{{ if and (ne $global.Context.User.ID $global.UserID) (ne $global.Context.User.ID 0) }}
								<button class="ui circular mini icon loading button" id="add-friend-button">
									<i class="horizontal ellipsis icon"></i>
								</button>
							{{ end }}
							{{ if eq $global.Context.User.ID $global.UserID }}
								<a href="/settings" class="ui circular mini teal icon button"
									title="{{ $global.T "Settings" }}">
									<i class="edit icon"></i>
								</a>
							{{ end }}
							{{ if hasAdmin $global.Context.User.Privileges }}
								<a href="https://aap.eggradio.tk/index.php?p=103&id={{ $global.UserID }}"
									target="_blank" title="Quick edit" class="ui circular mini blue icon button">
									<i class="folder open outline icon"></i>
								</a>
							{{ end }}
						</div>
					</div>
				</div>
			{{ with $global.Get "users/userpage?id=%.0f" .id }}
				{{ if .userpage }}
					{{ with parseUserpage .userpage }}
						<div class="ui raised segment twemoji" id="userpage-content">
							{{ html . }}
						</div>
					{{ end }}
				{{ end }}
			{{ end }}
			{{ $user := . }}
			
			<div class="ui segment">
				<div class="ui three column divided stackable grid">
<div class="ui three item bottom attached menu" id="rx-menu" style="margin-bottom: 0;">
				<a class="0 item" data-rx="0" href="/u/{{ $user.id }}">Regular</a>
				<a class="1 item" data-rx="1" href="/rx/u/{{ $user.id }}">Relax</a>
				<a class="1 item" data-rx="2" href="/ap/u/{{ $user.id }}">Autopilot</a>
		</div>
<div class="ui four item bottom attached menu" id="mode-menu">
				{{ range $k, $v := modes }}
					<a class="{{ favMode $favouritemode $k }}item" data-mode="{{ $k }}" href="/u/{{ $user.id }}?mode={{ $k }}">{{ $v }}</a>
				{{ end }}
			</div>
					<div class="row">
						<div class="column">				
						
					{{ $global.T "<b>%s</b> is" .username | html}} 


							{{ $global.T "from <b>%s</b>." (country .country true) | html }}
							{{ if $hstb1 }}	
							<br>{{ $global.T "Here since the beginning." }}
							{{ else }}
							{{ if $hstb2 }}	
							<br>{{ $global.T "Here since the beginning." }}
							{{ else }}
							{{ if $hstb3 }}	
							<br>{{ $global.T "Here since the beginning." }}
							{{ else }}
							{{ if $hstb4 }}	
							<br>{{ $global.T "Here since the beginning." }}
							{{ else }}
							<br>{{ $global.T "They signed up on osuHOW %s." (time $user.registered_on) | html }}
							{{ end }}
							{{ end }}
							{{ end }}
							{{ end }}
							<br>{{ $global.T "Last seen: %s." (time $user.latest_activity) | html }}
							<br>{{ with playstyle .play_style $global }}{{ $global.T "They play with %s." . }}{{ end }}
						</div>
							<meta name="og:image" content="https://a.eggradio.tk/{{$user.id}}"/>
 							<meta property="og:type" content="website" />
							<meta property="og:url" content="https://eggradio.tk/u/{{$user.id}}" />
							<meta property="og:title" content={{ $global.T "<b>%s</b>" .username}} />
							<meta property="og:description" content={{ $global.T "<b>%s</b> is a osuHOW player from <b>%s</b>." .username (country .country true)}} />
							<meta property="og:image" content="https://a.eggradio.tk/{{$user.id}}" />
							
						<div class="column">
							{{ range $k, $v := (slice .std .taiko .ctb .mania) }}
							{{ $maxcombo := qb "SELECT FORMAT(scores_relax.max_combo,0) AS combo FROM scores_relax WHERE userid = ? ORDER BY max_combo DESC;" $.UserID}}
								<div data-mode="{{ $k }}" {{ if ne $k (int $favouritemode) }} hidden{{ end }}>
									<table class="ui very basic two column compact table nopad">
										<tbody>
											
											{{ with .global_leaderboard_rank }}
												<tr>
													<td><b>{{ $global.T "Global rank" }}</b></td>
													<td class="right aligned">#{{ . }}</td>
												</tr>
											{{ end }}
											{{ with .country_leaderboard_rank }}
												<tr>
													<td><b>{{ $global.T "Country rank" }} &nbsp;{{ country $user.country false }}</b></td>
													<td class="right aligned">#{{ . }}</td>
												</tr>
											{{ end }}
											<tr>
												<td><b>{{ $global.T "PP" }}</b></td>
												<td class="right aligned">{{ humanize .pp }}</td>
											</tr>
											<tr>
												<td><b>{{ $global.T "Ranked score" }}</b></td>
												<td class="right aligned">{{ humanize .ranked_score }}</td>
											</tr>
											<tr>
												<td><b>{{ $global.T "Total score" }}</b></td>
												<td class="right aligned">{{ humanize .total_score }}</td>
											</tr>
											<tr>
												<td><b>{{ $global.T "Playcount" }}</b></td>
												<td class="right aligned">{{ humanize .playcount }}</td>
											</tr>
											<tr>
												<td><b>{{ $global.T "Max combo" }}</b></td>
												<td class="right aligned">{{ $maxcombo.combo }}</td>
											</tr>
											<tr>
												<td><b>{{ $global.T "Followers" }}</b></td>
												<td class="right aligned">{{ with $.Get "users/followers?userid=%d" $.UserID }} {{ .subscount }} {{ end }} </td>
											</tr>
											<tr>
												<td><b>{{ $global.T "Replays watched" }}</b></td>
												<td class="right aligned">{{ humanize .replays_watched }}</td>
											</tr>
											<tr>
												<td><b>{{ $global.T "Total hits" }}</b></td>
												<td class="right aligned">{{ humanize .total_hits }}</td>
											</tr>									<tr>
												<td><b>{{ $global.T "Accuracy" }}</b></td>
												<td class="right aligned">{{ printf "%.2f" .accuracy }}%</td>
											</tr>
										</tbody>
									</table>
									<div class="ui blue progress little margin top" data-percent="{{ levelPercent .level }}">
										<div class="bar">
											<div class="progress">{{ levelPercent .level }}%</div>
										</div>
										<div class="label">{{ $global.T "Level %s" (level .level) }}</div>
									</div>
								</div>
							{{ end }}
						</div>
					</div>
				</div>
			</div> <!-- end grid segment -->
			<div id="scores-zone">
				{{ range _range 4 }}
					<div data-mode="{{ . }}" {{ if ne . (int $favouritemode) }} hidden{{ end }} data-loaded="0">
					</div>
				{{ end }}
			</div>
					</button>
				</div>
			</div>
			<div class="ui modal">
				<i class="close icon"></i>
				<div class="content">
					<table class="ui definition table" id="score-data-table">
					</table>
				</div>
			</div>
		{{ end }}
	{{ end }}
</div>
{{ end }}

